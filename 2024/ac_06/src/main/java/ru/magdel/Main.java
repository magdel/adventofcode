package ru.magdel;

public class Main {
    private static final char GUARD = '^';
    private static final char OBSTACLE = '#';
    private static final char PATH = 'X';

    public static void main(String[] args) {
        String input2 = """
                ....#...................................#...............#.................#.......#...#...........................................
                .........................#.........#....................................#...........................#......##..............##...#.
                .....................................................................#.........................................#..#...............
                .............#........#...............................................................................#......................#....
                ....#.#.................................#......................................#...#..#..........#....#.....#.............#.......
                ....................#.......#..............#.......#.#.............................#......................................#.......
                ..............................................................................................#......#....................#.......
                .........#.#..#...............................#........#.#........................................................#..............#
                ....#...........#.......#.......#....#...#....#..........#..........#......#...#................#.........................#.......
                .......#...........................................................................................#.................#...........#
                ..................#.#....#..............................#....................#.................#....#..........#..........#.......
                ...#...............#...................................................#................#.........................................
                .................#..#.#.............#.#...................................#......................#....#..........#................
                .#..................#........................#..........#...........................#.......#......................#.#............
                ......#...........................................#.....#.....#...........#...........................#..............#............
                .........#...............................#.............................#.#.......................................................#
                ...#.........#.#........................#...#..............................................#...#...............#...#..#...........
                ..............................#.....................................#................#..........................#.........##......
                ..........#...........#.....#......#......#..............................#.....#......................................#...........
                ..........................#....#.........................................................#..................#...#.........#.......
                ......................................#...........#.........#...............................#.............#...............#.......
                .......................#........#.#....#...#...#................................................................#......#..........
                ......................#...............#................#..#.#...........#...#.......................#.........#.........#..#......
                ....#.................#..........#............#....#..............................................................#.#.............
                .........................................................................................................................#...##...
                .....................#.......#................................................##.............#........#........................#..
                ........................#..#.....#.#...............#.......#.................#.............................................#.#....
                ......................................................................................#..#.............................#..........
                ..#........................................................#..........................#..............#.#.....................#....
                ...#...................#............#...#.....#....#..................................#.......................#...................
                ...#...........#..............#............................................................#....#.....#.....................#.....
                ........................#..............#...................#.....#..#.............................................................
                .....#....................#....................##..........#..............#......#...............#..........#.....#..........##...
                ....#.......#..........................................................#....................................#.#..................#
                #......#.#.................................#........................................................................#.........#...
                ...............................#......#......................#....................................................................
                ..............#..........................#....................................#..........#.............#..........................
                .....#........#....#.........................#..#.................#.#.................#...........................................
                .................#..................#.#................................#..#..................................#......#.............
                ...........................#.......................................................#...................#............#.............
                .....................#.........#..#..........................#..................................#........#........................
                ..#................................................#.#.................................#.#..........#.....#......................#
                ..........................................................................#..................................................#.#..
                ..................................#..........................................#......................#.............................
                .......#...............#..............................................#......................................................#....
                ..........................................^....................#..................................................................
                .........#.........#.........................................................................................#......#....#........
                .........#.........#..............................................................................................................
                ........#....#......................#...............#...........#..................#...........................................##.
                ......#............#...........#................................................................#.......#.........................
                #.............................#..............................................................#..............#.....................
                ...................................#...........#...................................................#........#..........#..........
                ....#.....................................................................................................#...........#......#....
                ....................................................#....#...................................#....................................
                ............#........#............................#..........#.............................#.....#..#.#...........................
                ...........#.................................................................#.............#......................................
                ....#.........................................#.#.......#...............#...........................#............##...............
                ..................#..............#...#........................................................................#....#...........#..
                .....................#.....#...#.....#.............#..............#...#...................................#.......................
                .#...#.....#.............................................#...........#....#.......................................................
                .#.....#.............................#................#......................#........................#.........................#.
                ......................#.........................................#.............................................#.................#.
                ...#...#....................#.................................................................#............#....#.......#.........
                ...........#......#...............................#.......#......#........#..........#...........................................#
                ......................#....#..............##...........................................................#..........#...............
                .#......#.....................................................................#..#....#.....................#.....................
                ....##....#...#.........#.............................#.........#...................#.............#....#................#.........
                ..................................................................#...............................#...............................
                ....#.................#.#.........................................................................................................
                ........................#..........................#...........#...................................#.#.......#....................
                ...........#.....................................................................................#...............................#
                ...........................................#..................................#...................................................
                .....#.........#......#..........#.........#.................................................................................#....
                ....#.....................#....#..#.........................................................................#..#..................
                ........................##..#........................#...#.........#.................#......................#..#....#.............
                .............#................#.......#........#............................................................#......#..............
                #....#................................#.............#..........#........#.....#...#..........##.....................#.............
                ......#...#......#..........................................................................................#....#..#.........#...
                #.................#..............##....#........................#....#...........................................#..........#.#...
                ........................#.#..#........................................#.............................................##............
                ..........#.........#.........................................................................................##..................
                ....#....#...........#.................#......................#........................#...#....................................#.
                .......#..................................#..................#...................#...............................#.....#.....#....
                #................................#...........#................##...#............#.................................................
                .............................#...#....................................#...................................#...#..........#...#....
                .#......#.........#...#.......#.................##....#..................................................#...#....................
                ...........#........................................................................................................#.............
                ......................................#......#..........#.....#.....................#...................#.#.................#.....
                .....................................#............#................................................................##.............
                .......................................#....................#...........................................##..#.....................
                ..........................#.................................................................................#....................#
                ...........................................................#............#.........#..#....#.#............#.....#..................
                ....#.....................................#...........................................#........#.....................#............
                .............#.............#................#..........................#......................#..........................#........
                .........#.................#......#............#....#.#.............................#.......##......................#.#.......#...
                ..............................................................................................................#...................
                #...#...............................................#...................#........................#...............#................
                .......#...#.......#..#..#..#..........#..........................................................................................
                ......#.##....................#......#........#............#................#.............#...................#............#......
                .....#..#......#.......................#..............................#...............................#...........................
                .#.................................#......#..............................................#........................................
                ....#...........................#..#........#...............#..#.......................................#......##.#.........#......
                ..................................#..................#......................#.....................#.......#.....................#.
                .........#....................#....#...............................................#...................................#..........
                .........................................................#...#...............##..#...............................................#
                .#..#.............#.............#....................................#....................#.....#..#..........................#...
                .................#.........................#..#........................................#.................................#........
                .....................#....#................................#......#...............................................................
                ...............#..........................#...........#.............................................................#.........#...
                ...........##.......#................#..............................#..........................#....##.....#...................#..
                ......................#........#........#.........#..................................................##..#........................
                ....#........................#......................#.#..................#....#..................#.....................#..........
                .................#......#...#...................................#...............#....#.........#............................#.....
                #.................#...............................#......#..#..............................................###...#.......#........
                ..........#...........#..........................................................................................................#
                .......................#......................................#.................#.......#........#................................
                ..#.......#..#.............................................................................................................#......
                #.........#......#........................#.#..............................................#...................##.................
                ...#....#.....................................#...................................................................................
                .....................#.....................................................................#........................#.....#.......
                .....#..#...............................................................##......#.#......#..#.#.......#........................#..
                .......#..........#....................................#.........#.................#.................#.....................#......
                ..............##.................................................#................#.........#.#............#........#............#
                .....................#.............#....................#...#.................#.........#........#................................
                .............#...........................................#........................................................................
                .....#...#.............#..............#..............#..................................................................#......#..
                .....##...................................##.....#.....#..#.........#...............#..........#.....#............#.#...........#.
                ....#..................#.........#....................#....................#...#....#..............##............#..............#.
                ..................#..........#.#.....................................#....#..............#.......#.....#...............#......#..#
                ..............#.........#.............................................................................................#...........
                """;
        String input1 =
                "....#.....\n" +
                        ".........#\n" +
                        "..........\n" +
                        "..#.......\n" +
                        ".......#..\n" +
                        "..........\n" +
                        ".#..^.....\n" +
                        "........#.\n" +
                        "#.........\n" +
                        "......#...";
        var input = input2;
        var lines = input.split("\n");
        var colms = lines[0];
        char[][] map = new char[colms.length()][lines.length];
        for (int i = 0; i < lines.length; i++) {
            var line = lines[i];
            for (int j = 0; j < line.length(); j++) {
                map[j][i] = line.charAt(j);
            }
        }

        int distinctPositions = countDistinctPositions(map);
        System.out.println(distinctPositions);
    }

    private static int countDistinctPositions(char[][] map) {
        //find start
        int x = -1, y = -1, dir = 0; // starting position and direction

        for (int i = 0; i < map.length; i++) {
            for (int j = 0; j < map[i].length; j++) {
                if (map[j][i] == GUARD) {
                    x = j;
                    y = i;
                    break;
                }
            }
        }

        int rows = map.length;
        int cols = map[0].length;
        int[] dx = {0, 1, 0, -1};
        int[] dy = {-1, 0, 1, 0};
        boolean[][] visited = new boolean[rows][cols];

        while (true) {
            visited[x][y] = true;
            var px = x + dx[dir];
            var py = y + dy[dir];
            if (px < 0 || px >= map.length) {
                break;
            }
            if (py < 0 || py >= map[x].length) {
                break;
            }
            if (map[px][py] == OBSTACLE) {
                dir = (dir + 1) % 4; // turn right
            } else {
                x += dx[dir];
                y += dy[dir];
            }
        }

        int count = 0;
        for (int i = 0; i < rows; i++) {
            for (int j = 0; j < cols; j++) {
                if (visited[i][j]) {
                    count++;
                }
            }
        }

        return count;
    }


}